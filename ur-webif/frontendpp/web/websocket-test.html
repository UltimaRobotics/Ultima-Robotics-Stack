<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test Client</title>
    <link href="./assets/css/tailwind-3.4.17.js" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/all.min.css">
    <style>
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .pulse-dot {
            animation: pulse-dot 2s infinite;
        }
        
        .message-item {
            transition: all 0.2s ease;
        }
        
        .message-item:hover {
            transform: translateX(4px);
        }
        
        .filter-tag {
            transition: all 0.2s ease;
        }
        
        .filter-tag:hover {
            transform: scale(1.05);
        }
        
        .json-viewer {
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.4;
        }
        
        .json-key { color: #881391; }
        .json-string { color: #0d7e83; }
        .json-number { color: #2f508e; }
        .json-boolean { color: #d73a49; }
        .json-null { color: #6f42c1; }
        
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-network-wired text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-xl font-semibold text-gray-900">WebSocket Test Client</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div id="connection-status" class="w-3 h-3 bg-gray-400 rounded-full"></div>
                        <span id="connection-text" class="text-sm text-gray-600">Disconnected</span>
                    </div>
                    <button id="connect-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2">
                        <i class="fas fa-plug"></i>
                        <span>Connect</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Connection Settings -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-cog text-gray-600 mr-2"></i>
                Connection Settings
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">WebSocket URL</label>
                    <input type="text" id="ws-url" value="ws://0.0.0.0:9002" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Auto Reconnect</label>
                    <select id="auto-reconnect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="true">Enabled</option>
                        <option value="false">Disabled</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Max Messages</label>
                    <input type="number" id="max-messages" value="1000" min="10" max="10000"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>
        </div>

        <!-- Message Filters -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-filter text-gray-600 mr-2"></i>
                Message Filters
            </h2>
            
            <!-- Filter Controls -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Message Type</label>
                    <select id="filter-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">All Types</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Search Text</label>
                    <input type="text" id="filter-text" placeholder="Search in messages..."
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Time Range</label>
                    <select id="filter-time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">All Time</option>
                        <option value="1">Last 1 minute</option>
                        <option value="5">Last 5 minutes</option>
                        <option value="15">Last 15 minutes</option>
                        <option value="60">Last 1 hour</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Direction</label>
                    <select id="filter-direction" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Both</option>
                        <option value="sent">Sent Only</option>
                        <option value="received">Received Only</option>
                    </select>
                </div>
            </div>

            <!-- Active Filter Tags -->
            <div id="active-filters" class="flex flex-wrap gap-2">
                <!-- Filter tags will be added here dynamically -->
            </div>
        </div>

        <!-- Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Total Messages</p>
                        <p id="stat-total" class="text-2xl font-semibold text-gray-900">0</p>
                    </div>
                    <i class="fas fa-envelope text-blue-500 text-2xl"></i>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Sent</p>
                        <p id="stat-sent" class="text-2xl font-semibold text-green-600">0</p>
                    </div>
                    <i class="fas fa-paper-plane text-green-500 text-2xl"></i>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Received</p>
                        <p id="stat-received" class="text-2xl font-semibold text-blue-600">0</p>
                    </div>
                    <i class="fas fa-download text-blue-500 text-2xl"></i>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Filtered</p>
                        <p id="stat-filtered" class="text-2xl font-semibold text-orange-600">0</p>
                    </div>
                    <i class="fas fa-filter text-orange-500 text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Message List -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="border-b border-gray-200 p-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                        <i class="fas fa-list text-gray-600 mr-2"></i>
                        Live Messages
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button id="clear-btn" class="px-3 py-1 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            <i class="fas fa-trash mr-1"></i>
                            Clear
                        </button>
                        <button id="export-btn" class="px-3 py-1 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-download mr-1"></i>
                            Export
                        </button>
                        <button id="pause-btn" class="px-3 py-1 text-sm bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                            <i class="fas fa-pause mr-1"></i>
                            Pause
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="messages-container" class="h-96 overflow-y-auto scrollbar-thin p-4">
                <div class="text-center text-gray-500 py-8">
                    <i class="fas fa-inbox text-4xl mb-2"></i>
                    <p>No messages yet. Connect to WebSocket server to start receiving messages.</p>
                </div>
            </div>
        </div>

        <!-- Send Message -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mt-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-paper-plane text-gray-600 mr-2"></i>
                Send Message
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Message JSON</label>
                    <textarea id="send-message" rows="3" placeholder='{"type": "test", "data": "hello"}'
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"></textarea>
                </div>
                <div class="flex items-end">
                    <button id="send-btn" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2">
                        <i class="fas fa-paper-plane"></i>
                        <span>Send Message</span>
                    </button>
                </div>
            </div>
            <div class="mt-2">
                <button id="send-preset-btn" class="text-sm text-blue-600 hover:text-blue-800">
                    <i class="fas fa-magic mr-1"></i>
                    Use Preset Messages
                </button>
            </div>
        </div>
    </div>

    <!-- Preset Messages Modal -->
    <div id="preset-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="border-b border-gray-200 p-6">
                <h3 class="text-lg font-semibold text-gray-900">Preset Messages</h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 gap-3">
                    <button class="preset-message text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50" data-message='{"type": "auth", "token": "test-token"}'>
                        <div class="font-medium">Authentication</div>
                        <div class="text-sm text-gray-600">Send authentication message</div>
                    </button>
                    <button class="preset-message text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50" data-message='{"type": "request_network_priority_data", "timestamp": 0}'>
                        <div class="font-medium">Request Network Priority Data</div>
                        <div class="text-sm text-gray-600">Request network priority information</div>
                    </button>
                    <button class="preset-message text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50" data-message='{"type": "subscribe_updates", "section": "system-dashboard", "timestamp": 0}'>
                        <div class="font-medium">Subscribe to Updates</div>
                        <div class="text-sm text-gray-600">Subscribe to dashboard updates</div>
                    </button>
                    <button class="preset-message text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50" data-message='{"type": "heartbeat", "timestamp": 0}'>
                        <div class="font-medium">Heartbeat</div>
                        <div class="text-sm text-gray-600">Send heartbeat message</div>
                    </button>
                    <button class="preset-message text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50" data-message='{"type": "test", "data": "Hello WebSocket Server!"}'>
                        <div class="font-medium">Test Message</div>
                        <div class="text-sm text-gray-600">Simple test message</div>
                    </button>
                </div>
            </div>
            <div class="border-t border-gray-200 p-6 flex justify-end">
                <button id="close-preset-btn" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        class WebSocketTestClient {
            constructor() {
                this.ws = null;
                this.messages = [];
                this.messageTypes = new Set();
                this.isPaused = false;
                this.isAutoReconnect = true;
                this.maxMessages = 1000;
                this.stats = {
                    total: 0,
                    sent: 0,
                    received: 0,
                    filtered: 0
                };
                this.filters = {
                    type: '',
                    text: '',
                    time: '',
                    direction: ''
                };
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.updateConnectionStatus('disconnected');
            }
            
            setupEventListeners() {
                // Connection controls
                document.getElementById('connect-btn').addEventListener('click', () => this.toggleConnection());
                document.getElementById('ws-url').addEventListener('change', () => this.updateConnectionSettings());
                document.getElementById('auto-reconnect').addEventListener('change', () => this.updateConnectionSettings());
                document.getElementById('max-messages').addEventListener('change', () => this.updateConnectionSettings());
                
                // Filter controls
                document.getElementById('filter-type').addEventListener('change', (e) => this.setFilter('type', e.target.value));
                document.getElementById('filter-text').addEventListener('input', (e) => this.setFilter('text', e.target.value));
                document.getElementById('filter-time').addEventListener('change', (e) => this.setFilter('time', e.target.value));
                document.getElementById('filter-direction').addEventListener('change', (e) => this.setFilter('direction', e.target.value));
                
                // Message controls
                document.getElementById('clear-btn').addEventListener('click', () => this.clearMessages());
                document.getElementById('export-btn').addEventListener('click', () => this.exportMessages());
                document.getElementById('pause-btn').addEventListener('click', () => this.togglePause());
                document.getElementById('send-btn').addEventListener('click', () => this.sendMessage());
                
                // Preset messages
                document.getElementById('send-preset-btn').addEventListener('click', () => this.showPresetModal());
                document.getElementById('close-preset-btn').addEventListener('click', () => this.hidePresetModal());
                document.querySelectorAll('.preset-message').forEach(btn => {
                    btn.addEventListener('click', (e) => this.usePresetMessage(e.target.closest('.preset-message').dataset.message));
                });
            }
            
            toggleConnection() {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.disconnect();
                } else {
                    this.connect();
                }
            }
            
            connect() {
                const url = document.getElementById('ws-url').value;
                
                try {
                    this.ws = new WebSocket(url);
                    
                    this.ws.onopen = () => {
                        console.log('WebSocket connected');
                        this.updateConnectionStatus('connected');
                        this.addMessage({ type: 'system', message: 'Connected to WebSocket server' }, 'received');
                    };
                    
                    this.ws.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            this.addMessage(data, 'received');
                        } catch (e) {
                            this.addMessage({ type: 'raw', data: event.data }, 'received');
                        }
                    };
                    
                    this.ws.onclose = (event) => {
                        console.log('WebSocket disconnected:', event);
                        this.updateConnectionStatus('disconnected');
                        this.addMessage({ type: 'system', message: `Disconnected: ${event.code} - ${event.reason}` }, 'received');
                        
                        if (this.isAutoReconnect) {
                            setTimeout(() => this.connect(), 3000);
                        }
                    };
                    
                    this.ws.onerror = (error) => {
                        console.error('WebSocket error:', error);
                        this.updateConnectionStatus('error');
                        this.addMessage({ type: 'system', message: 'WebSocket error occurred' }, 'received');
                    };
                    
                } catch (error) {
                    console.error('Failed to connect:', error);
                    this.updateConnectionStatus('error');
                    this.addMessage({ type: 'system', message: `Connection failed: ${error.message}` }, 'received');
                }
            }
            
            disconnect() {
                if (this.ws) {
                    this.ws.close();
                    this.ws = null;
                }
            }
            
            sendMessage() {
                const messageText = document.getElementById('send-message').value;
                
                if (!messageText.trim()) {
                    alert('Please enter a message');
                    return;
                }
                
                if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {
                    alert('Not connected to WebSocket server');
                    return;
                }
                
                try {
                    const message = JSON.parse(messageText);
                    this.ws.send(JSON.stringify(message));
                    this.addMessage(message, 'sent');
                    document.getElementById('send-message').value = '';
                } catch (error) {
                    alert('Invalid JSON: ' + error.message);
                }
            }
            
            addMessage(data, direction) {
                if (this.isPaused && direction === 'received') return;
                
                const message = {
                    id: Date.now() + Math.random(),
                    timestamp: new Date(),
                    data: data,
                    direction: direction,
                    type: data.type || 'unknown'
                };
                
                this.messages.unshift(message);
                this.messageTypes.add(message.type);
                
                // Limit message count
                if (this.messages.length > this.maxMessages) {
                    this.messages = this.messages.slice(0, this.maxMessages);
                }
                
                // Update stats
                this.stats.total++;
                if (direction === 'sent') {
                    this.stats.sent++;
                } else {
                    this.stats.received++;
                }
                
                this.updateDisplay();
            }
            
            updateDisplay() {
                this.updateStats();
                this.updateFilterOptions();
                this.updateMessageList();
                this.updateActiveFilters();
            }
            
            updateStats() {
                document.getElementById('stat-total').textContent = this.stats.total;
                document.getElementById('stat-sent').textContent = this.stats.sent;
                document.getElementById('stat-received').textContent = this.stats.received;
                
                const filteredMessages = this.getFilteredMessages();
                document.getElementById('stat-filtered').textContent = filteredMessages.length;
            }
            
            updateFilterOptions() {
                const typeSelect = document.getElementById('filter-type');
                const currentValue = typeSelect.value;
                
                typeSelect.innerHTML = '<option value="">All Types</option>';
                Array.from(this.messageTypes).sort().forEach(type => {
                    typeSelect.innerHTML += `<option value="${type}">${type}</option>`;
                });
                
                typeSelect.value = currentValue;
            }
            
            updateMessageList() {
                const container = document.getElementById('messages-container');
                const messages = this.getFilteredMessages();
                
                if (messages.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-inbox text-4xl mb-2"></i>
                            <p>No messages found${this.hasActiveFilters() ? ' with current filters' : ''}</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = messages.map(msg => this.createMessageHTML(msg)).join('');
            }
            
            getFilteredMessages() {
                return this.messages.filter(msg => {
                    // Type filter
                    if (this.filters.type && msg.type !== this.filters.type) return false;
                    
                    // Text filter
                    if (this.filters.text) {
                        const searchText = this.filters.text.toLowerCase();
                        const messageText = JSON.stringify(msg.data).toLowerCase();
                        if (!messageText.includes(searchText)) return false;
                    }
                    
                    // Time filter
                    if (this.filters.time) {
                        const cutoffTime = new Date(Date.now() - (parseInt(this.filters.time) * 60 * 1000));
                        if (msg.timestamp < cutoffTime) return false;
                    }
                    
                    // Direction filter
                    if (this.filters.direction && msg.direction !== this.filters.direction) return false;
                    
                    return true;
                });
            }
            
            hasActiveFilters() {
                return Object.values(this.filters).some(value => value !== '');
            }
            
            createMessageHTML(message) {
                const time = message.timestamp.toLocaleTimeString();
                const isSent = message.direction === 'sent';
                const colorClass = isSent ? 'bg-green-50 border-green-200' : 'bg-blue-50 border-blue-200';
                const icon = isSent ? 'fa-paper-plane text-green-600' : 'fa-download text-blue-600';
                
                return `
                    <div class="message-item border ${colorClass} rounded-lg p-3 mb-2">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                <i class="fas ${icon}"></i>
                                <span class="text-sm font-medium text-gray-900">${message.type}</span>
                                <span class="text-xs text-gray-500">${time}</span>
                            </div>
                            <button class="text-gray-400 hover:text-gray-600" onclick="wsTestClient.copyMessage('${message.id}')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div class="json-viewer text-sm">
                            ${this.formatJSON(message.data)}
                        </div>
                    </div>
                `;
            }
            
            formatJSON(data) {
                try {
                    const json = JSON.stringify(data, null, 2);
                    return json
                        .replace(/"([^"]+)":/g, '<span class="json-key">"$1":</span>')
                        .replace(/: "([^"]+)"/g, ': <span class="json-string">"$1"</span>')
                        .replace(/: (\d+)/g, ': <span class="json-number">$1</span>')
                        .replace(/: (true|false)/g, ': <span class="json-boolean">$1</span>')
                        .replace(/: null/g, ': <span class="json-null">null</span>');
                } catch (e) {
                    return `<span class="text-gray-600">${data}</span>`;
                }
            }
            
            copyMessage(messageId) {
                const message = this.messages.find(m => m.id == messageId);
                if (message) {
                    navigator.clipboard.writeText(JSON.stringify(message.data, null, 2));
                    // Show feedback
                    event.target.closest('button').innerHTML = '<i class="fas fa-check"></i>';
                    setTimeout(() => {
                        event.target.closest('button').innerHTML = '<i class="fas fa-copy"></i>';
                    }, 2000);
                }
            }
            
            setFilter(filterType, value) {
                this.filters[filterType] = value;
                this.updateDisplay();
            }
            
            updateActiveFilters() {
                const container = document.getElementById('active-filters');
                const activeFilters = [];
                
                Object.entries(this.filters).forEach(([key, value]) => {
                    if (value) {
                        let label = value;
                        if (key === 'type') label = `Type: ${value}`;
                        if (key === 'text') label = `Search: "${value}"`;
                        if (key === 'time') label = `Time: Last ${value} min`;
                        if (key === 'direction') label = `Direction: ${value}`;
                        
                        activeFilters.push(`
                            <span class="filter-tag inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                ${label}
                                <button class="ml-2 text-blue-600 hover:text-blue-800" onclick="wsTestClient.clearFilter('${key}')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </span>
                        `);
                    }
                });
                
                if (activeFilters.length === 0) {
                    container.innerHTML = '<span class="text-sm text-gray-500">No active filters</span>';
                } else {
                    container.innerHTML = activeFilters.join('') + 
                        '<button class="text-sm text-red-600 hover:text-red-800 ml-2" onclick="wsTestClient.clearAllFilters()">Clear All</button>';
                }
            }
            
            clearFilter(filterType) {
                this.filters[filterType] = '';
                document.getElementById(`filter-${filterType}`).value = '';
                this.updateDisplay();
            }
            
            clearAllFilters() {
                Object.keys(this.filters).forEach(key => {
                    this.filters[key] = '';
                    document.getElementById(`filter-${key}`).value = '';
                });
                this.updateDisplay();
            }
            
            clearMessages() {
                if (confirm('Are you sure you want to clear all messages?')) {
                    this.messages = [];
                    this.messageTypes.clear();
                    this.stats = { total: 0, sent: 0, received: 0, filtered: 0 };
                    this.updateDisplay();
                }
            }
            
            exportMessages() {
                const messages = this.getFilteredMessages();
                const data = {
                    exportTime: new Date().toISOString(),
                    filters: this.filters,
                    stats: this.stats,
                    messages: messages.map(msg => ({
                        timestamp: msg.timestamp.toISOString(),
                        direction: msg.direction,
                        type: msg.type,
                        data: msg.data
                    }))
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `websocket-messages-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
            
            togglePause() {
                this.isPaused = !this.isPaused;
                const btn = document.getElementById('pause-btn');
                if (this.isPaused) {
                    btn.innerHTML = '<i class="fas fa-play mr-1"></i>Resume';
                    btn.classList.remove('bg-yellow-600', 'hover:bg-yellow-700');
                    btn.classList.add('bg-green-600', 'hover:bg-green-700');
                } else {
                    btn.innerHTML = '<i class="fas fa-pause mr-1"></i>Pause';
                    btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                    btn.classList.add('bg-yellow-600', 'hover:bg-yellow-700');
                }
            }
            
            showPresetModal() {
                document.getElementById('preset-modal').classList.remove('hidden');
            }
            
            hidePresetModal() {
                document.getElementById('preset-modal').classList.add('hidden');
            }
            
            usePresetMessage(messageTemplate) {
                try {
                    const message = JSON.parse(messageTemplate);
                    if (message.timestamp === 0) {
                        message.timestamp = Date.now();
                    }
                    document.getElementById('send-message').value = JSON.stringify(message, null, 2);
                    this.hidePresetModal();
                } catch (e) {
                    alert('Invalid preset message format');
                }
            }
            
            updateConnectionStatus(status) {
                const statusDot = document.getElementById('connection-status');
                const statusText = document.getElementById('connection-text');
                const connectBtn = document.getElementById('connect-btn');
                
                switch (status) {
                    case 'connected':
                        statusDot.className = 'w-3 h-3 bg-green-500 rounded-full';
                        statusText.textContent = 'Connected';
                        connectBtn.innerHTML = '<i class="fas fa-unplug"></i><span>Disconnect</span>';
                        connectBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                        connectBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                        break;
                    case 'disconnected':
                        statusDot.className = 'w-3 h-3 bg-gray-400 rounded-full';
                        statusText.textContent = 'Disconnected';
                        connectBtn.innerHTML = '<i class="fas fa-plug"></i><span>Connect</span>';
                        connectBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                        connectBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        break;
                    case 'error':
                        statusDot.className = 'w-3 h-3 bg-red-500 rounded-full pulse-dot';
                        statusText.textContent = 'Error';
                        connectBtn.innerHTML = '<i class="fas fa-plug"></i><span>Connect</span>';
                        connectBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                        connectBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        break;
                }
            }
            
            updateConnectionSettings() {
                this.isAutoReconnect = document.getElementById('auto-reconnect').value === 'true';
                this.maxMessages = parseInt(document.getElementById('max-messages').value);
            }
        }
        
        // Initialize the WebSocket test client
        const wsTestClient = new WebSocketTestClient();
    </script>
</body>
</html>
